stages:
  - sync

sync-to-github:
  stage: sync
  image: alpine:latest
  variables:
    GIT_DEPTH: "0"
  before_script:
    - apk add --no-cache git openssh-client
  only:
    - branches
  script:
    - git config --global user.name "GitLab CI"
    - git config --global user.email "ci@gitlab.com"
    - git remote add github "https://oauth2:${GITHUB_TOKEN}@${GITHUB_REPO_URL}" || git remote set-url github "https://oauth2:${GITHUB_TOKEN}@${GITHUB_REPO_URL}"
    - git push github "HEAD:${CI_COMMIT_REF_NAME}" --force
    - git push github --tags --force || true
